exports.id=538,exports.ids=[538],exports.modules={3538:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>i});var d=t(8732),s=t(4062),o=t(3157);t(9361);var n=e([s,o]);function i({Component:e,pageProps:a}){return(0,d.jsx)(s.Provider,{store:o.A,children:(0,d.jsx)(e,{...a})})}[s,o]=n.then?(await n)():n,r()}catch(e){r(e)}})},3157:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{A:()=>l});var d=t(9198),s=t(4358),o=t(7730),n=t(3257),i=t(4660),c=e([d,s,o,n,i]);[d,s,o,n,i]=c.then?(await c)():c;let l=(0,d.configureStore)({reducer:{auth:s.Ay,products:o.Ay,cart:n.Ay,reviews:i.Ay}});r()}catch(e){r(e)}})},3257:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Ay:()=>h,Mr:()=>l,ci:()=>n,fN:()=>i,je:()=>g,nI:()=>p});var d=t(9198),s=t(1190),o=e([d,s]);[d,s]=o.then?(await o)():o;let n=(0,d.createAsyncThunk)("cart/createCartForGuest",async(e,{rejectWithValue:a})=>{try{return(await s.zb.createCartForGuest(e)).data}catch(e){return a(e)}}),i=(0,d.createAsyncThunk)("cart/createCartForUser",async(e,{rejectWithValue:a})=>{try{return(await s.zb.createCartForUser()).data}catch(e){return a(e)}}),c=(0,d.createAsyncThunk)("cart/getCartById",async(e,{rejectWithValue:a})=>{try{return(await s.zb.getCartById(e)).data}catch(e){return a(e)}}),l=(0,d.createAsyncThunk)("cart/addItemToCart",async({cartId:e,itemData:a},{rejectWithValue:t})=>{try{return(await s.zb.addItemToCart(e,a)).data}catch(e){return t(e)}}),u=(0,d.createAsyncThunk)("cart/removeCartItem",async(e,{rejectWithValue:a})=>{try{return await s.zb.removeCartItem(e)}catch(e){return a(e)}}),g=(0,d.createAsyncThunk)("cart/getCartItems",async(e,{rejectWithValue:a})=>{try{return(await s.zb.getCartItems(e)).data}catch(e){return a(e)}}),y=(0,d.createSlice)({name:"cart",initialState:{cart:null,items:[],loading:!1,error:null},reducers:{resetCartState:e=>{e.cart=null,e.items=[],e.loading=!1,e.error=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,a)=>{e.loading=!1,e.cart=a.payload}).addCase(n.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,a)=>{e.loading=!1,e.cart=a.payload}).addCase(i.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,(e,a)=>{e.loading=!1,e.cart=a.payload}).addCase(c.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,a)=>{e.loading=!1,e.items.push(a.payload)}).addCase(l.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(u.pending,e=>{e.loading=!0,e.error=null}).addCase(u.fulfilled,(e,a)=>{e.loading=!1,e.items=e.items.filter(e=>e.id!==a.meta.arg)}).addCase(u.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(g.pending,e=>{e.loading=!0,e.error=null}).addCase(g.fulfilled,(e,a)=>{e.loading=!1,e.items=a.payload}).addCase(g.rejected,(e,a)=>{e.loading=!1,e.error=a.payload})}}),{resetCartState:p}=y.actions,h=y.reducer;r()}catch(e){r(e)}})},7730:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{$s:()=>u,Ay:()=>P,L$:()=>w,Lu:()=>f,_5:()=>c,kf:()=>l});var d=t(9198),s=t(1190),o=e([d,s]);[d,s]=o.then?(await o)():o;let n=(0,d.createAsyncThunk)("products/fetchProducts",async(e,{rejectWithValue:a})=>{try{return await s.GQ.getProducts()}catch(e){return a(e.response?.data||"Failed to fetch products")}}),i=(0,d.createAsyncThunk)("products/fetchProductsByPagination",async({page:e,limit:a},{rejectWithValue:t})=>{try{return await s.GQ.getProductsByPagination(e,a)}catch(e){return t(e.response?.data||"Failed to fetch products with pagination")}}),c=(0,d.createAsyncThunk)("products/fetchNewProductsByPagination",async({page:e,limit:a},{rejectWithValue:t})=>{try{return await s.GQ.getNewProductsByPagination(e,a)}catch(e){return t(e.response?.data||"Failed to fetch new products")}}),l=(0,d.createAsyncThunk)("products/fetchFeaturedProductsByPagination",async({page:e,limit:a},{rejectWithValue:t})=>{try{return await s.GQ.getFeaturedProductsByPagination(e,a)}catch(e){return t(e.response?.data||"Failed to fetch featured products")}}),u=(0,d.createAsyncThunk)("products/fetchProductDetail",async(e,{rejectWithValue:a})=>{try{return await s.GQ.getProductDetail(e)}catch(e){return a(e.response?.data||"Failed to fetch product details")}}),g=(0,d.createAsyncThunk)("products/createProduct",async(e,{rejectWithValue:a})=>{try{return await s.GQ.createProduct(e)}catch(e){return a(e.response?.data||"Failed to create product")}}),y=(0,d.createAsyncThunk)("products/updateProduct",async({slug:e,productData:a},{rejectWithValue:t})=>{try{return await s.GQ.updateProduct(e,a)}catch(e){return t(e.response?.data||"Failed to update product")}}),p=(0,d.createAsyncThunk)("products/deleteProduct",async(e,{rejectWithValue:a})=>{try{return await s.GQ.deleteProduct(e)}catch(e){return a(e.response?.data||"Failed to delete product")}}),h=(0,d.createSlice)({name:"products",initialState:{newProducts:{items:[],pagination:{totalItems:0,totalPages:0,currentPage:1,pageSize:10}},visibleNewProducts:[],featuredProducts:{items:[],pagination:{totalItems:0,totalPages:0,currentPage:1,pageSize:10}},visibleFeaturedProducts:[],loading:!1,error:null},reducers:{setVisibleNewProducts:(e,a)=>{e.visibleNewProducts=a.payload},setVisibleFeaturedProducts:(e,a)=>{e.visibleFeaturedProducts=a.payload},clearProductState:e=>{e.newProducts={items:[],pagination:{totalItems:0,totalPages:0,currentPage:1,pageSize:10}},e.visibleNewProducts=[],e.featuredProducts={items:[],pagination:{totalItems:0,totalPages:0,currentPage:1,pageSize:10}},e.visibleFeaturedProducts=[],e.loading=!1,e.error=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,a)=>{e.items=a.payload,e.loading=!1}).addCase(n.rejected,(e,a)=>{e.error=a.payload,e.loading=!1}),e.addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,a)=>{let{products:t,pagination:r}=a.payload.data;e.pagination={items:t||[],totalItems:r.totalItems||0,totalPages:r.totalPages||0,currentPage:r.currentPage||1,pageSize:r.pageSize||10},e.loading=!1}).addCase(i.rejected,(e,a)=>{e.error=a.payload,e.loading=!1}),e.addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,(e,a)=>{let{products:t,pagination:r}=a.payload.data,d=t.filter(a=>!e.newProducts.items.some(e=>e.id===a.id));e.newProducts.items=[...e.newProducts.items,...d],e.newProducts.pagination={totalItems:r.totalItems||0,totalPages:r.totalPages||0,currentPage:r.currentPage||1,pageSize:r.pageSize||10},e.visibleNewProducts=e.newProducts.items.slice(0,e.newProducts.pagination.pageSize),e.loading=!1}).addCase(c.rejected,(e,a)=>{e.error=a.payload,e.loading=!1}),e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,a)=>{let{products:t,pagination:r}=a.payload.data,d=t.filter(a=>!e.featuredProducts.items.some(e=>e.id===a.id));e.featuredProducts.items=[...e.featuredProducts.items,...d],e.featuredProducts.pagination={totalItems:r.totalItems||0,totalPages:r.totalPages||0,currentPage:r.currentPage||1,pageSize:r.pageSize||10},e.visibleFeaturedProducts=e.featuredProducts.items.slice(0,e.featuredProducts.pagination.pageSize),e.loading=!1}).addCase(l.rejected,(e,a)=>{e.error=a.payload,e.loading=!1}),e.addCase(u.pending,e=>{e.loading=!0,e.error=null}).addCase(u.fulfilled,(e,a)=>{e.currentProduct=a.payload,e.loading=!1}).addCase(u.rejected,(e,a)=>{e.error=a.payload,e.loading=!1}),e.addCase(g.pending,e=>{e.loading=!0,e.error=null}).addCase(g.fulfilled,(e,a)=>{e.items.push(a.payload),e.loading=!1}).addCase(g.rejected,(e,a)=>{e.error=a.payload,e.loading=!1}),e.addCase(y.pending,e=>{e.loading=!0,e.error=null}).addCase(y.fulfilled,(e,a)=>{let t=e.items.findIndex(e=>e.slug===a.payload.slug);-1!==t&&(e.items[t]=a.payload),e.loading=!1}).addCase(y.rejected,(e,a)=>{e.error=a.payload,e.loading=!1}),e.addCase(p.pending,e=>{e.loading=!0,e.error=null}).addCase(p.fulfilled,(e,a)=>{e.items=e.items.filter(e=>e.slug!==a.meta.arg),e.loading=!1}).addCase(p.rejected,(e,a)=>{e.error=a.payload,e.loading=!1})}}),{setVisibleNewProducts:f,setVisibleFeaturedProducts:w,clearProductState:m}=h.actions,P=h.reducer;r()}catch(e){r(e)}})},4660:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Ay:()=>u,Zx:()=>i,bx:()=>c,ik:()=>n});var d=t(9198),s=t(1190),o=e([d,s]);[d,s]=o.then?(await o)():o;let n=(0,d.createAsyncThunk)("reviews/fetchReviewsByProduct",async({productId:e,page:a,limit:t},r)=>{try{let r=await s.bi.getReviewsByProduct(e,a,t);if("success"===r.status)return{reviews:r.data,meta:r.meta};throw Error("Unexpected API response")}catch(e){return r.rejectWithValue(e.response?.data?.message||"Failed to fetch reviews")}}),i=(0,d.createAsyncThunk)("reviews/fetchAverageRating",async(e,a)=>{try{return(await s.bi.getAverageRating(e)).data}catch(e){return a.rejectWithValue(e.response?.data||"Failed to fetch average rating")}}),c=(0,d.createAsyncThunk)("reviews/createReview",async(e,a)=>{try{return(await s.bi.createReview(e)).data}catch(e){return a.rejectWithValue(e.response?.data||"Failed to create review")}}),l=(0,d.createAsyncThunk)("reviews/deleteReview",async(e,a)=>{try{return(await s.bi.deleteReview(e)).data}catch(e){return a.rejectWithValue(e.response?.data||"Failed to delete review")}}),u=(0,d.createSlice)({name:"reviews",initialState:{reviews:[],averageRating:0,isLoading:!1,error:null,pagination:{totalReviews:0,totalPages:1,currentPage:1}},reducers:{},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,a)=>{e.isLoading=!1,e.reviews=a.payload.reviews||[],e.pagination={totalReviews:a.payload.meta?.totalReviews||0,totalPages:a.payload.meta?.totalPages||1,currentPage:a.payload.meta?.currentPage||1}}).addCase(n.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload}),e.addCase(i.pending,e=>{e.isLoading=!0,e.error=null}).addCase(i.fulfilled,(e,a)=>{e.isLoading=!1,e.averageRating=a.payload?.averageRating||0}).addCase(i.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload}),e.addCase(c.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.fulfilled,(e,a)=>{e.isLoading=!1,e.reviews.unshift(a.payload),e.pagination.totalReviews+=1,e.reviews.length>10&&e.reviews.pop()}).addCase(c.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload}),e.addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,(e,a)=>{e.isLoading=!1,e.reviews=e.reviews.filter(e=>e.id!==a.meta.arg),e.pagination.totalReviews=Math.max(0,e.pagination.totalReviews-1)}).addCase(l.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload})}}).reducer;r()}catch(e){r(e)}})},4358:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Ay:()=>p,DY:()=>n,Lx:()=>c,RY:()=>i,ug:()=>u,vw:()=>y,y4:()=>l});var d=t(9198),s=t(1190),o=e([d,s]);[d,s]=o.then?(await o)():o;let n=(0,d.createAsyncThunk)("auth/registerUser",async(e,{rejectWithValue:a})=>{try{return await s.i$.register(e)}catch(e){return a(e.response?.data||e.message)}}),i=(0,d.createAsyncThunk)("auth/verifyOtp",async(e,{rejectWithValue:a})=>{try{return await s.i$.verifyOtp(e)}catch(e){return a(e.response?.data||e.message)}}),c=(0,d.createAsyncThunk)("auth/loginUser",async(e,{rejectWithValue:a})=>{try{return await s.i$.login(e)}catch(e){return a(e.response?.data||e.message)}}),l=(0,d.createAsyncThunk)("auth/logoutUser",async(e,{rejectWithValue:a})=>{try{return await s.i$.logout(),!0}catch(e){return a(e.response?.data||e.message)}}),u=(0,d.createAsyncThunk)("auth/getUserInfo",async(e,{rejectWithValue:a})=>{try{return await s.i$.getUserProfile()}catch(e){return a(e.response?.data||e.message)}}),g=(0,d.createSlice)({name:"auth",initialState:{user:null,token:null,loading:!1,error:null},reducers:{resetAuthState:e=>{e.user=null,e.token=null,e.loading=!1,e.error=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.loading=!0,e.error=null}),e.addCase(n.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user}),e.addCase(n.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}),e.addCase(i.pending,e=>{e.loading=!0,e.error=null}),e.addCase(i.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user}),e.addCase(i.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}),e.addCase(c.pending,e=>{e.loading=!0,e.error=null}),e.addCase(c.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.token=a.payload.accessToken}),e.addCase(c.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}),e.addCase(l.pending,e=>{e.loading=!0}),e.addCase(l.fulfilled,e=>{e.user=null,e.token=null,e.loading=!1}),e.addCase(l.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}),e.addCase(u.pending,e=>{e.loading=!0,e.error=null}),e.addCase(u.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload}),e.addCase(u.rejected,(e,a)=>{e.loading=!1,e.error=a.payload})}}),{resetAuthState:y}=g.actions,p=g.reducer;r()}catch(e){r(e)}})},1190:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{GQ:()=>l,bi:()=>g,i$:()=>c,zb:()=>u});var d=t(1428),s=t(6084),o=t(4358),n=e([d,s,o]);[d,s,o]=n.then?(await n)():n;let i=d.default.create({baseURL:"https://kltn-1a.onrender.com/api/"});i.interceptors.request.use(async e=>{try{let a=(0,s.gf)(),t=(0,s.u0)();a&&(e.headers.Authorization=`Bearer ${a}`),t&&(e.headers["x-session-id"]=t)}catch(e){console.error("Error adding headers:",e)}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>{console.log("Response received:",e),console.log("Response headers:",e.headers["x-session-id"]);let a=e.headers["x-session-id"];return a&&((0,s.mY)(a),console.log("Session ID saved from response:",a)),e},async e=>{console.error("Error response:",e.response);let a=e.config;if(e.response?.status===403&&!a._retry){if(a._retry=!0,a.url.includes("/users/refresh-token"))return console.error("Token refresh failed. Redirecting to login..."),(0,s.i1)(),store.dispatch((0,o.vw)()),Promise.reject(Error("Please log in again."));try{let e=await c.refreshToken();return a.headers.Authorization=`Bearer ${e}`,i(a)}catch(e){return console.error("Error during token refresh:",e),Promise.reject(e)}}return Promise.reject(e)});let c={register:async e=>{try{return(await i.post("users/register",e)).data}catch(e){throw e}},verifyOtp:async e=>{try{return(await i.post("users/verify-otp",e)).data}catch(e){throw e}},login:async e=>{try{let a=await i.post("users/login",e),{accessToken:t,refreshToken:r}=a.data.data;t&&r&&((0,s.WG)(t),(0,s.fE)(r),(0,s.yb)());let d=a.headers["x-session-id"];return d&&((0,s.mY)(d),console.log("Session ID received and saved during login:",d)),a.data}catch(e){throw e}},logout:async()=>{try{let e=(0,s.ve)(),a=(0,s.F6)();return await i.post("users/logout",{refreshToken:e,userId:a}),(0,s.i1)(),(0,s.FA)(),(0,s.Fb)(),(0,s.i1)(),(0,s.eF)(),(0,s.yb)(),{message:"Logout successful"}}catch(e){throw e.response?.data||"Logout failed"}},getUserProfile:async()=>{try{return(await i.get("users/profile")).data.data}catch(e){throw e.response?.data||"Failed to fetch user profile"}},refreshToken:async()=>{try{let e=(0,s.ve)();(0,s.F6)();let{accessToken:a,refreshToken:t}=(await i.post("users/refresh-token",{get_refreshToken:e})).data.data;return a&&t&&((0,s.WG)(a),(0,s.fE)(t)),a}catch(e){throw Error("Token refresh failed. Please log in again.")}}},l={createProduct:async e=>(await i.post("products/",e)).data,getProducts:async()=>(await i.get("products/")).data.data,getProductDetail:async e=>(await i.get(`products/${e}`)).data.data,updateProduct:async(e,a)=>(await i.put(`products/${e}`,a)).data,deleteProduct:async e=>(await i.delete(`products/${e}`)).data,getProductsByPagination:async(e,a)=>(await i.get(`products/pagination?page=${e}&limit=${a}`)).data,getNewProductsByPagination:async(e,a)=>(await i.get(`products/new?page=${e}&limit=${a}`)).data,getFeaturedProductsByPagination:async(e,a)=>(await i.get(`products/featured?page=${e}&limit=${a}`)).data},u={createCartForGuest:async e=>{try{let a=await i.post("carts/guest",e),{id:t}=a.data.data;return t&&(console.log("Cart ID:",t),(0,s.Om)(t)),a.data}catch(e){throw e.response?.data||"Failed to create cart for guest."}},createCartForUser:async()=>{try{let e=await i.post("carts/user"),{id:a}=e.data.data;return a&&(console.log("Cart ID:",a),(0,s.Om)(a)),e.data}catch(e){throw e.response?.data||"Failed to create or retrieve cart for user."}},getCartById:async e=>{try{return(await i.get(`carts/${e}`)).data}catch(e){throw e.response?.data||"Failed to fetch cart details."}},addItemToCart:async(e,a)=>{try{return(await i.post(`carts/${e}/items`,a)).data}catch(e){throw e.response?.data||"Failed to add item to cart."}},removeCartItem:async e=>{try{return(await i.delete(`carts/items/${e}`)).data}catch(e){throw e.response?.data||"Failed to remove item from cart."}},getCartItems:async e=>{try{return(await i.get(`carts/${e}/items`)).data}catch(e){throw e.response?.data||"Failed to fetch cart items."}}},g={createReview:async e=>{try{return(await i.post("reviews/",e)).data}catch(e){throw e.response?.data||"Failed to create review."}},getReviewsByProduct:async(e,a,t)=>{try{return(await i.get(`reviews/product/${e}?page=${a}&limit=${t}`)).data}catch(e){throw e.response?.data||"Failed to fetch reviews."}},getAverageRating:async e=>{try{return(await i.get(`reviews/product/${e}/average-rating`)).data}catch(e){throw e.response?.data||"Failed to fetch average rating."}},deleteReview:async e=>{try{return(await i.delete(`reviews/${e}`)).data}catch(e){throw e.response?.data||"Failed to delete review."}}};r()}catch(e){r(e)}})},6084:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Cy:()=>A,F6:()=>w,FA:()=>f,Fb:()=>m,Om:()=>F,WG:()=>u,eF:()=>y,fE:()=>p,gf:()=>g,i1:()=>v,mY:()=>P,u0:()=>C,ve:()=>h,yb:()=>k});var d=t(6338),s=e([d]);d=(s.then?(await s)():s)[0];let o="token",n="refreshToken",i="userId",c="sessionId",l="cartId",u=e=>d.default.set(o,e,{expires:7,secure:!0,sameSite:"Strict"}),g=()=>d.default.get(o),y=()=>d.default.remove(o),p=e=>d.default.set(n,e,{expires:7,secure:!0,sameSite:"Strict"}),h=()=>d.default.get(n),f=()=>d.default.remove(n),w=()=>d.default.get(i),m=()=>d.default.remove(i),P=e=>d.default.set(c,e,{expires:7,secure:!1,sameSite:"Strict"}),C=()=>d.default.get(c),v=()=>d.default.remove(c),F=e=>d.default.set(l,e,{expires:7,secure:!1,sameSite:"Strict"}),A=()=>d.default.get(l),k=()=>d.default.remove(l);r()}catch(e){r(e)}})},9361:()=>{}};